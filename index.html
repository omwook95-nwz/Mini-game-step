<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stage Jump Betting Game — Prototype</title>
  <style>
    :root {
      --bg: #0f1221;
      --panel: #141833;
      --panel-2: #1b1f44;
      --text: #e8eaf6;
      --muted: #aab0d6;
      --accent: #7c4dff;
      --accent-2: #00e5ff;
      --win: #00c853;
      --lose: #ff5252;
      --warn: #ffd54f;
      --border: #242a5e;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 80% -20%, rgba(124,77,255,0.15), transparent),
                  radial-gradient(1000px 600px at -10% 120%, rgba(0,229,255,0.15), transparent),
                  var(--bg);
      color: var(--text);
    }
    .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid var(--border);
      border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 12px; font-size: 24px; letter-spacing: -0.2px; }
    .sub { color: var(--muted); font-size: 13px; margin-bottom: 16px; }
    .row { display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: end; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom: 6px; }
    input[type="number"]{
      width: 100%; padding: 12px 14px; font-size: 16px; color: var(--text);
      background: #0c0f25; border: 1px solid var(--border); border-radius: 12px; outline: none;
    }
    input[type="number"]:disabled { opacity: 0.6; }
    button {
      padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border); cursor: pointer;
      background: #11163a; color: var(--text); font-weight: 600; letter-spacing: .2px;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
      box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }
    button:hover { transform: translateY(-1px); }
    button.primary { background: linear-gradient(135deg, var(--accent), #5b3bd6); }
    button.secondary { background: linear-gradient(135deg, var(--accent-2), #0097a7); color: #00131a; }
    button.ghost { background: transparent; }
    button:disabled { opacity: .5; cursor: not-allowed; transform:none; }

    .grid { display: grid; grid-template-columns: 1fr 320px; gap: 16px; margin-top: 16px; }

    .stageboard { border: 1px solid var(--border); border-radius: 14px; padding: 12px; background: rgba(255,255,255,0.02); }
    .stagehead { display:flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .stagehead h2 { font-size: 16px; margin: 0; }
    .pill { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: #0e1435; border: 1px solid var(--border); color: var(--muted); }

    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 8px 10px; border-bottom: 1px dashed rgba(255,255,255,0.08); text-align: right; }
    th:nth-child(1), td:nth-child(1) { text-align: left; }
    tr.active { background: rgba(124,77,255,0.12); }
    tr.success { background: rgba(0,200,83,0.15); }
    tr.fail { background: rgba(255,82,82,0.15); }

    .play { border: 1px solid var(--border); border-radius: 14px; padding: 16px; display:flex; flex-direction: column; gap: 12px; }
    .status { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .status .box { border: 1px solid var(--border); border-radius: 12px; padding: 10px; }
    .status .title { font-size: 12px; color: var(--muted); }
    .status .value { font-size: 20px; margin-top: 4px; font-weight: 700; }

    .banner { border-radius: 12px; padding: 12px; font-weight: 700; text-align:center; }
    .banner.win { background: rgba(0,200,83,0.18); border: 1px solid rgba(0,200,83,0.5); }
    .banner.lose { background: rgba(255,82,82,0.18); border: 1px solid rgba(255,82,82,0.5); }
    .banner.info { background: rgba(124,77,255,0.18); border: 1px solid rgba(124,77,255,0.5); }

    .actions { display:flex; gap: 8px; justify-content: center; flex-wrap: wrap; }

    .footer { color: var(--muted); font-size: 12px; margin-top: 10px; text-align: center; }
    .hint { color: var(--muted); font-size: 12px; }

    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>단계 점프 베팅 게임 <span style="font-size:14px;color:var(--muted)">— 시현용 프로토타입</span></h1>
      <div class="sub">성공 확률은 매 단계 <b>80%</b> 고정. 각 단계 성공 시 배당(누적 배수)이 상승합니다. 언제든 <b>Cash Out</b> 하거나 <b>Go</b>로 다음 단계에 도전하세요. 10단계 성공 시 자동 Cash Out & 재시작.</div>

      <div class="row">
        <div>
          <label>베팅 금액</label>
          <input id="betInput" type="number" min="1" step="1" value="1000" />
          <div class="hint">배당은 공정배당(1 / 0.8 = 1.25)을 기준으로 단계별 누적 <b>×1.25^단계</b>로 계산됩니다.</div>
        </div>
        <div>
          <button id="startBtn" class="primary">Game Start</button>
        </div>
        <div>
          <button id="resetBtn" class="ghost" disabled>Reset</button>
        </div>
      </div>

      <div class="grid">
        <div class="play">
          <div class="status">
            <div class="box">
              <div class="title">현재 단계</div>
              <div class="value" id="stageVal">-</div>
            </div>
            <div class="box">
              <div class="title">Cash Out 시 수령액</div>
              <div class="value" id="cashoutVal">-</div>
            </div>
          </div>

          <div id="banner" class="banner info">베팅액을 입력하고 <b>Game Start</b>를 누르세요.</div>

          <div class="actions">
            <button id="goBtn" class="secondary" disabled>Go 🚀</button>
            <button id="cashBtn" disabled>Cash Out 💰</button>
          </div>
          <div class="footer">단계별 성공 확률 80%. 실패 시 해당 라운드의 베팅액은 0이 됩니다.</div>
        </div>

        <div class="stageboard">
          <div class="stagehead">
            <h2>단계 & 배당표</h2>
            <span class="pill">누적 배수 ×1.25^단계</span>
          </div>
          <table>
            <thead>
              <tr>
                <th>단계</th>
                <th>누적 배수</th>
                <th>성공여부</th>
              </tr>
            </thead>
            <tbody id="stageTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- CONFIG ---
    const MAX_STAGE = 10;
    const SUCCESS_P = 0.80; // 80%

    // 공정배당: per-stage 공정 배수는 1 / 0.8 = 1.25
    const FAIR_PER_STAGE = 1 / SUCCESS_P; // 1.25

    // 누적 배수 계산 (1.25^stage, 소수 둘째 자리 반올림)
    const cumulativeMultiplier = (stage) => {
      // stage: 0 => 1.00 (아직 성공한 단계 없음)
      const mul = Math.pow(FAIR_PER_STAGE, stage);
      return Math.round(mul * 100) / 100;
    };

    // --- STATE ---
    let state = {
      bet: 0,
      stage: 0, // 성공 완료한 단계 수 (0~10)
      running: false,
      history: Array.from({ length: MAX_STAGE }, () => null) // true/false/null
    };

    // --- DOM ---
    const betInput = document.getElementById('betInput');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const goBtn = document.getElementById('goBtn');
    const cashBtn = document.getElementById('cashBtn');
    const banner = document.getElementById('banner');
    const stageVal = document.getElementById('stageVal');
    const cashoutVal = document.getElementById('cashoutVal');
    const stageTable = document.getElementById('stageTable');

    // --- INIT TABLE ---
    function renderTable() {
      stageTable.innerHTML = '';
      for (let i = 1; i <= MAX_STAGE; i++) {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td');
        const td2 = document.createElement('td');
        const td3 = document.createElement('td');
        td1.textContent = `${i} 단계`;
        td2.textContent = `× ${cumulativeMultiplier(i).toFixed(2)}`;
        td3.textContent = '-';
        tr.dataset.stage = i;
        stageTable.appendChild(tr);
        tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
      }
      highlightActiveRow();
    }

    function highlightActiveRow(){
      [...stageTable.children].forEach((tr) => tr.className = '');
      // 다음 도전할 단계 강조 (stage는 완료한 수)
      const next = state.stage + 1;
      if (next <= MAX_STAGE) {
        const row = [...stageTable.children][next - 1];
        if (row) row.classList.add('active');
      }
      // 결과 마킹
      for (let i = 0; i < MAX_STAGE; i++) {
        const status = state.history[i];
        const row = stageTable.children[i];
        if (!row) continue;
        const cell = row.children[2];
        if (status === true) { row.classList.add('success'); cell.textContent = '성공 ✅'; }
        else if (status === false) { row.classList.add('fail'); cell.textContent = '실패 ❌'; }
        else { cell.textContent = '-'; }
      }
    }

    // --- UI UPDATE ---
    function updateUI(msg, type='info'){
      stageVal.textContent = state.running ? `${state.stage} / ${MAX_STAGE}` : '-';
      const cashMul = cumulativeMultiplier(state.stage);
      const cashAmt = state.bet * cashMul;
      cashoutVal.textContent = state.running ? `${formatKRW(cashAmt)}` : '-';

      banner.className = `banner ${type}`;
      banner.innerHTML = msg;

      betInput.disabled = state.running;
      startBtn.disabled = state.running;
      resetBtn.disabled = !state.running;
      goBtn.disabled = !state.running;
      cashBtn.disabled = !state.running || state.stage === 0; // 최소 1단계 성공 후 현금화 가능하도록 하려면 
      // 요구사항이 "언제든 Cash Out"이라면 아래로 바꾸세요:
      // cashBtn.disabled = !state.running;

      highlightActiveRow();
    }

    function formatKRW(n){
      return n.toLocaleString('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 });
    }

    // --- GAME FLOW ---
    function startGame(){
      const bet = Number(betInput.value);
      if (!Number.isFinite(bet) || bet <= 0) {
        alert('베팅 금액을 올바르게 입력하세요.');
        return;
      }
      state.bet = Math.floor(bet);
      state.stage = 0;
      state.running = true;
      state.history = Array.from({ length: MAX_STAGE }, () => null);

      updateUI(`라운드 시작! <b>${formatKRW(state.bet)}</b> 베팅했습니다. <br/> <b>Go</b>를 눌러 1단계를 도전하세요.`, 'info');
      renderTable();
    }

    function roll(){
      // 0~1 난수 < 0.8 이면 성공
      return Math.random() < SUCCESS_P;
    }

    function doGo(){
      if (!state.running) return;
      const targetStage = state.stage + 1;
      const ok = roll();
      state.history[state.stage] = ok; // 현재 도전 단계 인덱스에 결과 기록

      if (ok){
        state.stage++;
        if (state.stage >= MAX_STAGE){
          // 10단계 성공: 자동 Cash Out 및 재시작
          const payout = Math.floor(state.bet * cumulativeMultiplier(state.stage));
          updateUI(`🎉 <b>${MAX_STAGE}단계 전부 성공!</b> 자동 Cash Out으로 <b>${formatKRW(payout)}</b> 획득했습니다.`, 'win');
          renderTable();
          // 잠시 후 자동 재시작 안내
          endRound();
          return;
        }
        updateUI(`✅ <b>${targetStage}단계 성공!</b> 계속하시려면 <b>Go</b>, 그만하시려면 <b>Cash Out</b>을 누르세요.`, 'win');
        renderTable();
      } else {
        // 실패: 베팅액 0
        updateUI(`❌ <b>${targetStage}단계 실패!</b> 이번 라운드 베팅액은 소멸되었습니다. <br/>다시 시작하려면 <b>Reset</b> 또는 <b>Game Start</b>를 누르세요.`, 'lose');
        renderTable();
        endRound();
      }
    }

    function doCashOut(){
      if (!state.running) return;
      const payout = Math.floor(state.bet * cumulativeMultiplier(state.stage));
      updateUI(`💰 Cash Out! <b>${state.stage}단계</b>에서 <b>${formatKRW(payout)}</b> 수령했습니다.`, 'win');
      endRound();
    }

    function endRound(){
      // 라운드 종료 상태로 전환 (버튼/입력 초기화)
      state.running = false;
      betInput.disabled = false;
      startBtn.disabled = false;
      resetBtn.disabled = false;
      goBtn.disabled = true;
      cashBtn.disabled = true;
      // stageVal, cashoutVal은 유지 / 배너는 메시지 유지
    }

    function hardReset(){
      state = { bet: 0, stage: 0, running: false, history: Array.from({ length: MAX_STAGE }, () => null) };
      betInput.disabled = false; startBtn.disabled = false; resetBtn.disabled = true; goBtn.disabled = true; cashBtn.disabled = true;
      stageVal.textContent = '-'; cashoutVal.textContent = '-';
      banner.className = 'banner info'; banner.innerHTML = '베팅액을 입력하고 <b>Game Start</b>를 누르세요.';
      renderTable();
    }

    // --- EVENTS ---
    startBtn.addEventListener('click', startGame);
    goBtn.addEventListener('click', doGo);
    cashBtn.addEventListener('click', doCashOut);
    resetBtn.addEventListener('click', hardReset);

    // --- FIRST RENDER ---
    renderTable();
  </script>
</body>
</html>
