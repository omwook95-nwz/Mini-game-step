<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stage Jump Betting Game â€” Prototype</title>
  <style>
    :root {
      --bg: #0f1221;
      --panel: #141833;
      --panel-2: #1b1f44;
      --text: #e8eaf6;
      --muted: #aab0d6;
      --accent: #7c4dff;
      --accent-2: #00e5ff;
      --win: #00c853;
      --lose: #ff5252;
      --warn: #ffd54f;
      --border: #242a5e;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 80% -20%, rgba(124,77,255,0.15), transparent),
                  radial-gradient(1000px 600px at -10% 120%, rgba(0,229,255,0.15), transparent),
                  var(--bg);
      color: var(--text);
    }
    .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid var(--border);
      border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 12px; font-size: 24px; letter-spacing: -0.2px; }
    .sub { color: var(--muted); font-size: 13px; margin-bottom: 16px; }
    .row { display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: end; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom: 6px; }
    input[type="number"]{
      width: 100%; padding: 12px 14px; font-size: 16px; color: var(--text);
      background: #0c0f25; border: 1px solid var(--border); border-radius: 12px; outline: none;
    }
    input[type="number"]:disabled { opacity: 0.6; }
    button {
      padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border); cursor: pointer;
      background: #11163a; color: var(--text); font-weight: 600; letter-spacing: .2px;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
      box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }
    button:hover { transform: translateY(-1px); }
    button.primary { background: linear-gradient(135deg, var(--accent), #5b3bd6); }
    button.secondary { background: linear-gradient(135deg, var(--accent-2), #0097a7); color: #00131a; }
    button.ghost { background: transparent; }
    button:disabled { opacity: .5; cursor: not-allowed; transform:none; }

    .grid { display: grid; grid-template-columns: 1fr 320px; gap: 16px; margin-top: 16px; }

    .stageboard { border: 1px solid var(--border); border-radius: 14px; padding: 12px; background: rgba(255,255,255,0.02); }
    .stagehead { display:flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .stagehead h2 { font-size: 16px; margin: 0; }
    .pill { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: #0e1435; border: 1px solid var(--border); color: var(--muted); }

    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 8px 10px; border-bottom: 1px dashed rgba(255,255,255,0.08); text-align: right; }
    th:nth-child(1), td:nth-child(1) { text-align: left; }
    tr.active { background: rgba(124,77,255,0.12); }
    tr.success { background: rgba(0,200,83,0.15); }
    tr.fail { background: rgba(255,82,82,0.15); }

    .play { border: 1px solid var(--border); border-radius: 14px; padding: 16px; display:flex; flex-direction: column; gap: 12px; }
    .status { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .status .box { border: 1px solid var(--border); border-radius: 12px; padding: 10px; }
    .status .title { font-size: 12px; color: var(--muted); }
    .status .value { font-size: 20px; margin-top: 4px; font-weight: 700; }

    .banner { border-radius: 12px; padding: 12px; font-weight: 700; text-align:center; }
    .banner.win { background: rgba(0,200,83,0.18); border: 1px solid rgba(0,200,83,0.5); }
    .banner.lose { background: rgba(255,82,82,0.18); border: 1px solid rgba(255,82,82,0.5); }
    .banner.info { background: rgba(124,77,255,0.18); border: 1px solid rgba(124,77,255,0.5); }

    .actions { display:flex; gap: 8px; justify-content: center; flex-wrap: wrap; }

    .footer { color: var(--muted); font-size: 12px; margin-top: 10px; text-align: center; }
    .hint { color: var(--muted); font-size: 12px; }

    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ë‹¨ê³„ ì í”„ ë² íŒ… ê²Œì„ <span style="font-size:14px;color:var(--muted)">â€” ì‹œí˜„ìš© í”„ë¡œí† íƒ€ì…</span></h1>
      <div class="sub">ì„±ê³µ í™•ë¥ ì€ ë§¤ ë‹¨ê³„ <b>80%</b> ê³ ì •. ê° ë‹¨ê³„ ì„±ê³µ ì‹œ ë°°ë‹¹(ëˆ„ì  ë°°ìˆ˜)ì´ ìƒìŠ¹í•©ë‹ˆë‹¤. ì–¸ì œë“  <b>Cash Out</b> í•˜ê±°ë‚˜ <b>Go</b>ë¡œ ë‹¤ìŒ ë‹¨ê³„ì— ë„ì „í•˜ì„¸ìš”. 10ë‹¨ê³„ ì„±ê³µ ì‹œ ìë™ Cash Out & ì¬ì‹œì‘.</div>

      <div class="row">
        <div>
          <label>ë² íŒ… ê¸ˆì•¡</label>
          <input id="betInput" type="number" min="1" step="1" value="1000" />
          <div class="hint">ë°°ë‹¹ì€ ê³µì •ë°°ë‹¹(1 / 0.8 = 1.25)ì„ ê¸°ì¤€ìœ¼ë¡œ ë‹¨ê³„ë³„ ëˆ„ì  <b>Ã—1.25^ë‹¨ê³„</b>ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
        </div>
        <div>
          <button id="startBtn" class="primary">Game Start</button>
        </div>
        <div>
          <button id="resetBtn" class="ghost" disabled>Reset</button>
        </div>
      </div>

      <div class="grid">
        <div class="play">
          <div class="status">
            <div class="box">
              <div class="title">í˜„ì¬ ë‹¨ê³„</div>
              <div class="value" id="stageVal">-</div>
            </div>
            <div class="box">
              <div class="title">Cash Out ì‹œ ìˆ˜ë ¹ì•¡</div>
              <div class="value" id="cashoutVal">-</div>
            </div>
          </div>

          <div id="banner" class="banner info">ë² íŒ…ì•¡ì„ ì…ë ¥í•˜ê³  <b>Game Start</b>ë¥¼ ëˆ„ë¥´ì„¸ìš”.</div>

          <div class="actions">
            <button id="goBtn" class="secondary" disabled>Go ğŸš€</button>
            <button id="cashBtn" disabled>Cash Out ğŸ’°</button>
          </div>
          <div class="footer">ë‹¨ê³„ë³„ ì„±ê³µ í™•ë¥  80%. ì‹¤íŒ¨ ì‹œ í•´ë‹¹ ë¼ìš´ë“œì˜ ë² íŒ…ì•¡ì€ 0ì´ ë©ë‹ˆë‹¤.</div>
        </div>

        <div class="stageboard">
          <div class="stagehead">
            <h2>ë‹¨ê³„ & ë°°ë‹¹í‘œ</h2>
            <span class="pill">ëˆ„ì  ë°°ìˆ˜ Ã—1.25^ë‹¨ê³„</span>
          </div>
          <table>
            <thead>
              <tr>
                <th>ë‹¨ê³„</th>
                <th>ëˆ„ì  ë°°ìˆ˜</th>
                <th>ì„±ê³µì—¬ë¶€</th>
              </tr>
            </thead>
            <tbody id="stageTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- CONFIG ---
    const MAX_STAGE = 10;
    const SUCCESS_P = 0.80; // 80%

    // ê³µì •ë°°ë‹¹: per-stage ê³µì • ë°°ìˆ˜ëŠ” 1 / 0.8 = 1.25
    const FAIR_PER_STAGE = 1 / SUCCESS_P; // 1.25

    // ëˆ„ì  ë°°ìˆ˜ ê³„ì‚° (1.25^stage, ì†Œìˆ˜ ë‘˜ì§¸ ìë¦¬ ë°˜ì˜¬ë¦¼)
    const cumulativeMultiplier = (stage) => {
      // stage: 0 => 1.00 (ì•„ì§ ì„±ê³µí•œ ë‹¨ê³„ ì—†ìŒ)
      const mul = Math.pow(FAIR_PER_STAGE, stage);
      return Math.round(mul * 100) / 100;
    };

    // --- STATE ---
    let state = {
      bet: 0,
      stage: 0, // ì„±ê³µ ì™„ë£Œí•œ ë‹¨ê³„ ìˆ˜ (0~10)
      running: false,
      history: Array.from({ length: MAX_STAGE }, () => null) // true/false/null
    };

    // --- DOM ---
    const betInput = document.getElementById('betInput');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const goBtn = document.getElementById('goBtn');
    const cashBtn = document.getElementById('cashBtn');
    const banner = document.getElementById('banner');
    const stageVal = document.getElementById('stageVal');
    const cashoutVal = document.getElementById('cashoutVal');
    const stageTable = document.getElementById('stageTable');

    // --- INIT TABLE ---
    function renderTable() {
      stageTable.innerHTML = '';
      for (let i = 1; i <= MAX_STAGE; i++) {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td');
        const td2 = document.createElement('td');
        const td3 = document.createElement('td');
        td1.textContent = `${i} ë‹¨ê³„`;
        td2.textContent = `Ã— ${cumulativeMultiplier(i).toFixed(2)}`;
        td3.textContent = '-';
        tr.dataset.stage = i;
        stageTable.appendChild(tr);
        tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
      }
      highlightActiveRow();
    }

    function highlightActiveRow(){
      [...stageTable.children].forEach((tr) => tr.className = '');
      // ë‹¤ìŒ ë„ì „í•  ë‹¨ê³„ ê°•ì¡° (stageëŠ” ì™„ë£Œí•œ ìˆ˜)
      const next = state.stage + 1;
      if (next <= MAX_STAGE) {
        const row = [...stageTable.children][next - 1];
        if (row) row.classList.add('active');
      }
      // ê²°ê³¼ ë§ˆí‚¹
      for (let i = 0; i < MAX_STAGE; i++) {
        const status = state.history[i];
        const row = stageTable.children[i];
        if (!row) continue;
        const cell = row.children[2];
        if (status === true) { row.classList.add('success'); cell.textContent = 'ì„±ê³µ âœ…'; }
        else if (status === false) { row.classList.add('fail'); cell.textContent = 'ì‹¤íŒ¨ âŒ'; }
        else { cell.textContent = '-'; }
      }
    }

    // --- UI UPDATE ---
    function updateUI(msg, type='info'){
      stageVal.textContent = state.running ? `${state.stage} / ${MAX_STAGE}` : '-';
      const cashMul = cumulativeMultiplier(state.stage);
      const cashAmt = state.bet * cashMul;
      cashoutVal.textContent = state.running ? `${formatKRW(cashAmt)}` : '-';

      banner.className = `banner ${type}`;
      banner.innerHTML = msg;

      betInput.disabled = state.running;
      startBtn.disabled = state.running;
      resetBtn.disabled = !state.running;
      goBtn.disabled = !state.running;
      cashBtn.disabled = !state.running || state.stage === 0; // ìµœì†Œ 1ë‹¨ê³„ ì„±ê³µ í›„ í˜„ê¸ˆí™” ê°€ëŠ¥í•˜ë„ë¡ í•˜ë ¤ë©´ 
      // ìš”êµ¬ì‚¬í•­ì´ "ì–¸ì œë“  Cash Out"ì´ë¼ë©´ ì•„ë˜ë¡œ ë°”ê¾¸ì„¸ìš”:
      // cashBtn.disabled = !state.running;

      highlightActiveRow();
    }

    function formatKRW(n){
      return n.toLocaleString('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 });
    }

    // --- GAME FLOW ---
    function startGame(){
      const bet = Number(betInput.value);
      if (!Number.isFinite(bet) || bet <= 0) {
        alert('ë² íŒ… ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      state.bet = Math.floor(bet);
      state.stage = 0;
      state.running = true;
      state.history = Array.from({ length: MAX_STAGE }, () => null);

      updateUI(`ë¼ìš´ë“œ ì‹œì‘! <b>${formatKRW(state.bet)}</b> ë² íŒ…í–ˆìŠµë‹ˆë‹¤. <br/> <b>Go</b>ë¥¼ ëˆŒëŸ¬ 1ë‹¨ê³„ë¥¼ ë„ì „í•˜ì„¸ìš”.`, 'info');
      renderTable();
    }

    function roll(){
      // 0~1 ë‚œìˆ˜ < 0.8 ì´ë©´ ì„±ê³µ
      return Math.random() < SUCCESS_P;
    }

    function doGo(){
      if (!state.running) return;
      const targetStage = state.stage + 1;
      const ok = roll();
      state.history[state.stage] = ok; // í˜„ì¬ ë„ì „ ë‹¨ê³„ ì¸ë±ìŠ¤ì— ê²°ê³¼ ê¸°ë¡

      if (ok){
        state.stage++;
        if (state.stage >= MAX_STAGE){
          // 10ë‹¨ê³„ ì„±ê³µ: ìë™ Cash Out ë° ì¬ì‹œì‘
          const payout = Math.floor(state.bet * cumulativeMultiplier(state.stage));
          updateUI(`ğŸ‰ <b>${MAX_STAGE}ë‹¨ê³„ ì „ë¶€ ì„±ê³µ!</b> ìë™ Cash Outìœ¼ë¡œ <b>${formatKRW(payout)}</b> íšë“í–ˆìŠµë‹ˆë‹¤.`, 'win');
          renderTable();
          // ì ì‹œ í›„ ìë™ ì¬ì‹œì‘ ì•ˆë‚´
          endRound();
          return;
        }
        updateUI(`âœ… <b>${targetStage}ë‹¨ê³„ ì„±ê³µ!</b> ê³„ì†í•˜ì‹œë ¤ë©´ <b>Go</b>, ê·¸ë§Œí•˜ì‹œë ¤ë©´ <b>Cash Out</b>ì„ ëˆ„ë¥´ì„¸ìš”.`, 'win');
        renderTable();
      } else {
        // ì‹¤íŒ¨: ë² íŒ…ì•¡ 0
        updateUI(`âŒ <b>${targetStage}ë‹¨ê³„ ì‹¤íŒ¨!</b> ì´ë²ˆ ë¼ìš´ë“œ ë² íŒ…ì•¡ì€ ì†Œë©¸ë˜ì—ˆìŠµë‹ˆë‹¤. <br/>ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ <b>Reset</b> ë˜ëŠ” <b>Game Start</b>ë¥¼ ëˆ„ë¥´ì„¸ìš”.`, 'lose');
        renderTable();
        endRound();
      }
    }

    function doCashOut(){
      if (!state.running) return;
      const payout = Math.floor(state.bet * cumulativeMultiplier(state.stage));
      updateUI(`ğŸ’° Cash Out! <b>${state.stage}ë‹¨ê³„</b>ì—ì„œ <b>${formatKRW(payout)}</b> ìˆ˜ë ¹í–ˆìŠµë‹ˆë‹¤.`, 'win');
      endRound();
    }

    function endRound(){
      // ë¼ìš´ë“œ ì¢…ë£Œ ìƒíƒœë¡œ ì „í™˜ (ë²„íŠ¼/ì…ë ¥ ì´ˆê¸°í™”)
      state.running = false;
      betInput.disabled = false;
      startBtn.disabled = false;
      resetBtn.disabled = false;
      goBtn.disabled = true;
      cashBtn.disabled = true;
      // stageVal, cashoutValì€ ìœ ì§€ / ë°°ë„ˆëŠ” ë©”ì‹œì§€ ìœ ì§€
    }

    function hardReset(){
      state = { bet: 0, stage: 0, running: false, history: Array.from({ length: MAX_STAGE }, () => null) };
      betInput.disabled = false; startBtn.disabled = false; resetBtn.disabled = true; goBtn.disabled = true; cashBtn.disabled = true;
      stageVal.textContent = '-'; cashoutVal.textContent = '-';
      banner.className = 'banner info'; banner.innerHTML = 'ë² íŒ…ì•¡ì„ ì…ë ¥í•˜ê³  <b>Game Start</b>ë¥¼ ëˆ„ë¥´ì„¸ìš”.';
      renderTable();
    }

    // --- EVENTS ---
    startBtn.addEventListener('click', startGame);
    goBtn.addEventListener('click', doGo);
    cashBtn.addEventListener('click', doCashOut);
    resetBtn.addEventListener('click', hardReset);

    // --- FIRST RENDER ---
    renderTable();
  </script>
</body>
</html>
